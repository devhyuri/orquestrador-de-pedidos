generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  RECEIVED
  ENQUEUED
  PROCESSING_ENRICHMENT
  ENRICHED
  FAILED_ENRICHMENT
}

model Order {
  id               String      @id @default(uuid())
  externalOrderId  String      @map("external_order_id")
  idempotencyKey   String      @unique @map("idempotency_key")
  status           OrderStatus @default(RECEIVED)
  payload          Json        @default("{}")
  totalAmount      Decimal     @map("total_amount") @db.Decimal(10, 2)
  currency         String      @db.VarChar(3)
  enrichmentData  Json?       @map("enrichment_data")
  error            Json?       @map("error")
  createdAt        DateTime    @default(now()) @map("created_at")
  updatedAt        DateTime    @updatedAt @map("updated_at")

  @@index([status])
  @@index([idempotencyKey])
  @@map("orders")
}
